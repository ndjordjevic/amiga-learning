; $VER: CDIntegrity 47.1 (25.12.2020)
; 

Assign >NIL: EXISTS AmigaOS3.2CD:
If warn
Echo "Fatal error - AmigaOS3.2CD: volume is missing."
Quit
EndIf

Assign >NIL: EXISTS RAM:
If warn
Echo "Fatal error - RAM: volume is missing."
Quit
EndIf

If not Exists AmigaOS3.2CD:C/MD5SUM
Echo "Fatal error - AmigaOS3.2CD:C/MD5SUM is missing."
Quit
Endif

If not Exists AmigaOS3.2CD:C/Search
Echo "Fatal error - AmigaOS3.2CD:C/Search is missing."
Quit
Endif

If not Exists AmigaOS3.2CD:C/Delete
Echo "Fatal error - AmigaOS3.2CD:C/Delete is missing."
Quit
Endif

If not Exists AmigaOS3.2CD:C/Wait
Echo "Fatal error - AmigaOS3.2CD:C/Wait is missing."
Quit
Endif

If not Exists AmigaOS3.2CD:Utilities/More
Echo "Fatal error - AmigaOS3.2CD:Utilities/More is missing."
Quit
Endif

If not Exists AmigaOS3.2CD:S/AmigaOS3.2CD.MD5.hashes
Echo "Fatal error - File AmigaOS3.2CD:S/AmigaOS3.2CD.MD5.hashes is missing."
Quit
Endif

Echo ""
Echo "An integrity check of the AmigaOS3.2CD: volume will be able to" 
Echo "report on the current condition of your AmigaOS 3.2 CD-ROM contents."
Echo ""   
Echo "This is a rather lengthy process that takes up lots of system resources."
Ask "Would you like to conduct an AmigaOS3.2CD: integrity check? (Yes or No)"

If NOT WARN
Echo ""
Echo "Program terminated by user request."
Echo ""
Quit
EndIF

If exists RAM:CDIntegrity.log
AmigaOS3.2CD:C/Delete >NIL: RAM:CDIntegrity.log force
Endif

Echo "AmigaOS3.2CD: integrity check conducted on" `date` >RAM:CDIntegrity.log
Echo "" >>RAM:CDIntegrity.log

If exists RAM:CDScan
AmigaOS3.2CD:C/Delete >NIL: RAM:CDScan force
Endif

If exists RAM:stop
AmigaOS3.2CD:C/Delete >NIL: RAM:stop force
Endif

Echo "AmigaOS3.2CD:C/MD5SUM CHECK AmigaOS3.2CD:S/AmigaOS3.2CD.MD5.hashes WARN >>RAM:CDIntegrity.log" >RAM:CDScan
Echo "Echo 1 >RAM:stop" >>RAM:CDScan
Protect RAM:CDScan +rwes

RUN >NIL: execute RAM:CDScan

Echo "*Ec"

Echo "The AmigaOS3.2CD: file integrity check process will take quite some time."
Echo "Please be patient."
Echo ""
Echo NOLINE "In progress "

Lab startingloop
Echo NOLINE "."
AmigaOS3.2CD:C/WAIT 1 SECS
If exists RAM:stop
Echo ""
skip resumeoperations
EndIf
skip back startingloop

lab resumeoperations

If exists RAM:CDScan
AmigaOS3.2CD:C/Delete >NIL: RAM:CDScan force
Endif

If exists RAM:stop
AmigaOS3.2CD:C/Delete >NIL: RAM:stop force
Endif

AmigaOS3.2CD:C/Search RAM:CDIntegrity.log mismatch quiet

If warn
Echo "Scan completed." >>RAM:CDIntegrity.log
Echo "" >>RAM:CDIntegrity.log
Echo "No file integrity errors were found!" >>RAM:CDIntegrity.log
EndIf

Echo "" >>RAM:CDIntegrity.log
Echo "This log file is available as RAM:CDIntegrity.log" >>RAM:CDIntegrity.log
Echo "" >>RAM:CDIntegrity.log

AmigaOS3.2CD:Utilities/More RAM:CDIntegrity.log

Quit